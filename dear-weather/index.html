<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dear Weather</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="icon" type="image/png" href="/logo.png" /> 
    
    <style>
/* ============================================
   IMPORTS & FONTS
   ============================================ */
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

/* ============================================
   ANIMATIONS
   ============================================ */
@keyframes slideUpFadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.animate-in {
    animation: slideUpFadeIn 0.5s ease-out forwards;
}

/* ============================================
   BASE STYLES & BACKGROUND (Mobile Look)
   ============================================ */

body {
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    color: #fff;
    margin: 0;
    padding: 0;
    /* Soft Blue Gradient Mobile Background */
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    background-attachment: fixed;
    overflow-x: hidden;
}

/* Container positioning */
.container {
    position: relative;
    z-index: 2;
    padding-top: 20px;
    padding-bottom: 50px;
}

/* ============================================
   GLASS CARD EFFECT (Main Elements)
   ============================================ */

.glass-card {
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 1.5rem;
    background: rgba(255, 255, 255, 0.15); /* Light, transparent base */
    backdrop-filter: blur(15px);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    padding: 1.5rem;
    color: #fff;
    transition: transform 0.3s ease;
    height: 100%;
}

/* Specific Card Styles for detailed look (Tecno style) */
.detail-card {
    min-height: 120px;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 1.2rem;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    transition: background 0.3s;
}

.detail-card .icon-label {
    font-size: 0.9rem;
    opacity: 0.8;
}

.detail-card .value {
    font-size: 1.8rem;
    font-weight: 600;
    line-height: 1.2;
}

.detail-card .sub-text {
    font-size: 0.75rem;
    opacity: 0.7;
}

/* ============================================
   MAIN DISPLAY
   ============================================ */
#city-name-header {
    font-size: 2rem;
    font-weight: 600;
    text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
}
#current-temp {
    font-size: 6rem;
    font-weight: 300;
    line-height: 1;
}
#weather-desc {
    font-size: 1.5rem;
    opacity: 0.9;
}

/* ============================================
   HOURLY & DAILY FORECAST
   ============================================ */

/* Hourly Forecast Container (Mobile style scroll) */
#hourly-forecast-row {
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
}
#hourly-forecast-row::-webkit-scrollbar {
    display: none; /* Chrome, Safari */
}
.hourly-card-item {
    min-width: 80px;
    padding: 10px 5px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 1rem;
    text-align: center;
    transition: transform 0.3s;
}
.hourly-card-item:hover {
    transform: translateY(-5px);
}
.daily-forecast-item {
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}
.daily-forecast-item:last-child {
    border-bottom: none;
}

/* ============================================
   UTILITY & CONTROLS
   ============================================ */

.form-control {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
}
.form-control::placeholder {
    color: rgba(255, 255, 255, 0.7);
}
.btn-primary {
    background: #ffc107;
    border-color: #ffc107;
    color: #000;
    font-weight: 600;
}
.btn-primary:hover {
    background: #e0a800;
    border-color: #e0a800;
}

.fav-city-btn {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: #fff;
}
    </style>
</head>
<body>

    <div class="container">
        <div class="row justify-content-center">
            
            <div class="col-12 col-lg-8">
                
                <header class="mb-4">
                    <h1 id="city-name-header" class="text-center">Weather Now</h1> 
                    
                    <div class="text-center mb-3" id="favourites-container">
                    </div>

                    <div style="position: relative;">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" placeholder="Enter City Name..." id="search-input" autocomplete="off">
                            <button class="btn btn-primary" type="button" id="search-button">Search</button>
                            <button class="btn btn-outline-light" type="button" id="detect-location-button" style="border-radius: 0.375rem;">
                                <i class="bi bi-geo-alt-fill"></i>
                            </button>
                        </div>
                        <div id="autocomplete-container" class="list-group"></div>
                    </div>
                </header>

                <div class="d-flex justify-content-center align-items-center mb-4">
                    <div class="form-check form-switch text-white">
                        <input class="form-check-input" type="checkbox" role="switch" id="unit-toggle" style="font-size: 1.5rem;">
                        <label class="form-check-label ms-2" for="unit-toggle" id="unit-label" style="font-size: 1.2rem;">°C</label>
                    </div>
                    <button class="btn btn-sm ms-3" id="save-city-button" style="background: rgba(255,255,255,0.2); color: white;">
                        <i class="bi bi-star"></i> Save
                    </button>
                </div>

                <div class="alert alert-danger d-none" role="alert" id="error-message"></div>

                <div class="glass-card p-4 mb-4 d-none animate-in" id="weather-card">
                    
                    <div class="row align-items-center">
                        <div class="col-8">
                            <h1 id="current-temp" class="mb-0">28°C</h1>
                            <p id="weather-desc" class="mb-0">Clear Sky</p>
                            <p id="feels-like" class="mb-0" style="opacity: 0.7;">Feels like: 25°C</p>
                        </div>
                        <div class="col-4 text-end">
                            <img id="weather-icon" src="https://openweathermap.org/img/wn/01d@4x.png" alt="Weather Icon" style="width: 100%;">
                        </div>
                    </div>

                    <hr style="border-color: rgba(255,255,255,0.3);">

                    <h5 class="mb-3 mt-3">Next 72 Hours</h5>
                    <div class="d-flex gap-3" id="hourly-forecast-row">
                        </div>

                </div>
                <div class="row g-3" id="detail-cards-grid">

                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-wind"></i> Wind</p>
                            <span class="value" id="wind-speed-val">...</span>
                            <p class="sub-text mb-0 mt-2"><i class="bi bi-speedometer2"></i> Pressure: <span id="pressure-val">...</span></p>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-droplet-half"></i> Humidity</p>
                            <span class="value" id="humidity-val">...</span>
                            <p class="sub-text mb-0 mt-2"><i class="bi bi-eye"></i> Visibility: <span id="visibility-val">...</span></p>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-sun"></i> Sun Cycle</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-sunrise-fill text-warning"></i> 
                                    <span class="d-block" id="sunrise-time" style="font-size: 1rem; font-weight: 500;">...</span>
                                </div>
                                <div>
                                    <i class="bi bi-sunset-fill text-danger"></i> 
                                    <span class="d-block" id="sunset-time" style="font-size: 1rem; font-weight: 500;">...</span>
                                </div>
                            </div>
                            <p class="sub-text mt-2 mb-0">Total daylight hours</p>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-sun-fill"></i> UV Index</p>
                            <span class="value" id="uv-index-val">...</span>
                            <p class="sub-text mb-0 mt-2" id="uv-level">...</p>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-thermometer"></i> Min/Max Temp</p>
                            <span class="value" id="temp-min-max-val">...</span>
                            <p class="sub-text mb-0 mt-2">Today's temperature range</p>
                        </div>
                    </div>
                    
                    <div class="col-6">
                        <div class="detail-card">
                            <p class="icon-label mb-1"><i class="bi bi-cloud-haze2-fill"></i> Air Quality (AQI)</p>
                            <span class="value" id="aqi-val">...</span>
                            <p class="sub-text mb-0 mt-2" id="aqi-level">...</p>
                        </div>
                    </div>

                </div>
                <h4 class="text-white mt-5 mb-3">Next 7 Days</h4>
                <div class="glass-card p-3 mb-5" id="daily-forecast-list">
                    </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
// ============================================
// GLOBAL VARIABLES
// ============================================
let currentUnit = 'metric';
let favouriteCities = [];
let currentDisplayedCity = null;
let autocompleteRequestTimeout;

// ============================================
// DOM ELEMENT SELECTION (Updated to new structure)
// ============================================
const searchInput = document.getElementById("search-input");
const searchButton = document.getElementById("search-button");
const autocompleteContainer = document.getElementById("autocomplete-container");
const detectLocationButton = document.getElementById("detect-location-button");
const unitToggle = document.getElementById("unit-toggle");
const unitLabel = document.getElementById("unit-label");
const saveCityButton = document.getElementById("save-city-button");
const favouritesContainer = document.getElementById("favourites-container");
const errorMessage = document.getElementById("error-message");
const weatherCard = document.getElementById("weather-card");
const cityNameHeader = document.getElementById("city-name-header");

// Main Card Elements
const weatherIcon = document.getElementById("weather-icon");
const currentTemp = document.getElementById("current-temp");
const weatherDesc = document.getElementById("weather-desc");
const feelsLike = document.getElementById("feels-like");

// Detail Card Elements
const windSpeedVal = document.getElementById("wind-speed-val");
const pressureVal = document.getElementById("pressure-val");
const humidityVal = document.getElementById("humidity-val");
const visibilityVal = document.getElementById("visibility-val");
const sunriseTime = document.getElementById("sunrise-time");
const sunsetTime = document.getElementById("sunset-time");
const uvIndexVal = document.getElementById("uv-index-val");
const uvLevel = document.getElementById("uv-level");
const tempMinMaxVal = document.getElementById("temp-min-max-val");
const aqiVal = document.getElementById("aqi-val");
const aqiLevel = document.getElementById("aqi-level");

// Forecast Elements
const hourlyForecastRow = document.getElementById("hourly-forecast-row");
const dailyForecastList = document.getElementById("daily-forecast-list");


// ============================================
// EVENT LISTENERS
// ============================================
document.addEventListener("DOMContentLoaded", () => {
    loadFavourites();
    fetchWeather("Mumbai"); // Default search on load
});
searchButton.addEventListener("click", () => {
    const city = searchInput.value;
    if (city) {
        fetchWeather(city);
        clearAutocomplete();
    }
});
searchInput.addEventListener("keyup", (event) => {
    if (event.key === "Enter") {
        fetchWeather(searchInput.value);
        clearAutocomplete();
    }
});
searchInput.addEventListener("input", handleSearchInput);
document.addEventListener("click", (e) => {
    if (e.target.id !== "search-input") {
        clearAutocomplete();
    }
});
detectLocationButton.addEventListener("click", () => {
    navigator.geolocation.getCurrentPosition(
        (position) => {
            const { latitude, longitude } = position.coords;
            fetchWeather(null, latitude, longitude);
        },
        (error) => {
            console.error("Geolocation error:", error);
            showError("Location access failed.");
        }
    );
});
unitToggle.addEventListener("change", () => {
    currentUnit = unitToggle.checked ? 'imperial' : 'metric';
    unitLabel.textContent = unitToggle.checked ? '°F' : '°C';
    if (currentDisplayedCity) {
        fetchWeather(currentDisplayedCity);
    }
});
saveCityButton.addEventListener("click", toggleFavourite);


// ============================================
// MAIN WEATHER FETCHING FUNCTION
// ============================================
function fetchWeather(city = null, lat = null, lon = null) {
    showLoading();
    
    let weatherUrl, forecastUrl;
    
    if (city) {
        weatherUrl = `/api/currentWeather?q=${city}&units=${currentUnit}`;
        forecastUrl = `/api/forecast?q=${city}&units=${currentUnit}`; 
    } else {
        weatherUrl = `/api/currentWeather?lat=${lat}&lon=${lon}&units=${currentUnit}`;
        forecastUrl = `/api/forecast?lat=${lat}&lon=${lon}&units=${currentUnit}`;
    }

    Promise.all([fetch(weatherUrl), fetch(forecastUrl)])
        .then(([weatherRes, forecastRes]) => {
            if (!weatherRes.ok) return weatherRes.json().then(err => { throw new Error(err.error || "Current weather not found"); });
            if (!forecastRes.ok) return forecastRes.json().then(err => { throw new Error(err.error || "Forecast data not found"); });
            return Promise.all([weatherRes.json(), forecastRes.json()]);
        })
        .then(([weatherData, forecastData]) => {
            hideLoading();
            updateWeatherUI(weatherData);
            updateHourlyUI(forecastData); // For Next 72 Hours
            updateForecastUI(forecastData); // For 7-Day List
            currentDisplayedCity = weatherData.name;
            updateSaveButtonState(weatherData.name);
        })
        .catch(error => {
            console.error("Fetch error:", error);
            showError(error.message.includes("not found") ? "City not found. Check spelling." : error.message);
        });
}


// ============================================
// UI UPDATE: CURRENT WEATHER & DETAIL CARDS
// ============================================
function updateWeatherUI(data) {
    errorMessage.classList.add("d-none");
    
    // --- Units ---
    const tempUnit = currentUnit === 'metric' ? '°C' : '°F';
    const speedUnit = currentUnit === 'metric' ? 'km/h' : 'mph';
    const distUnit = currentUnit === 'metric' ? 'km' : 'mi';
    
    const windSpeedMps = data.wind.speed;
    const windSpeedVal = currentUnit === 'metric' ? (windSpeedMps * 3.6).toFixed(1) : windSpeedMps.toFixed(1);
    const visibilityVal = currentUnit === 'metric' ? (data.visibility / 1000).toFixed(1) : (data.visibility * 0.000621371).toFixed(1);

    // --- Main Card Update ---
    cityNameHeader.textContent = data.name; // Top header city name
    currentTemp.textContent = `${Math.round(data.main.temp)}${tempUnit}`;
    weatherDesc.textContent = data.weather[0].description;
    feelsLike.textContent = `Feels like: ${Math.round(data.main.feels_like)}${tempUnit}`;
    
    const iconCode = data.weather[0].icon;
    weatherIcon.src = `https://openweathermap.org/img/wn/${iconCode}@4x.png`;
    
    // --- Detail Cards Update ---
    humidityVal.textContent = `${data.main.humidity}%`;
    windSpeedVal.textContent = `${windSpeedVal} ${speedUnit}`;
    pressureVal.textContent = `${data.main.pressure} hPa`;
    visibilityVal.textContent = `${visibilityVal} ${distUnit}`;
    
    // Sunrise/Sunset (Converted using timezone offset)
    sunriseTime.textContent = formatTime(data.sys.sunrise, data.timezone);
    sunsetTime.textContent = formatTime(data.sys.sunset, data.timezone);
    
    // Min/Max Temp
    tempMinMaxVal.textContent = `${Math.round(data.main.temp_min)}${tempUnit} / ${Math.round(data.main.temp_max)}${tempUnit}`;
    
    // --- Mock Data for missing APIs (UV and AQI) ---
    // We use mock logic based on current conditions for demonstration:
    
    // Mock AQI Logic
    const aqi = Math.max(20, Math.min(150, 100 - Math.round(data.main.temp) * 2 + (data.main.pressure - 1000))); 
    // Mock UV Logic (higher temp/clear sky = higher UV)
    const uvIndex = Math.max(1, Math.min(10, Math.floor(data.main.temp / 5) + (iconCode.endsWith('n') ? -2 : 0))); 
    
    aqiVal.textContent = aqi;
    uvIndexVal.textContent = uvIndex;
    
    // Set colors/levels for Mock Data
    if (uvIndex >= 6) { uvLevel.textContent = "High"; uvLevel.className = "sub-text mt-2 mb-0 text-danger"; }
    else if (uvIndex >= 3) { uvLevel.textContent = "Moderate"; uvLevel.className = "sub-text mt-2 mb-0 text-warning"; }
    else { uvLevel.textContent = "Low"; uvLevel.className = "sub-text mt-2 mb-0 text-success"; }
    
    if (aqi >= 100) { aqiLevel.textContent = "Unhealthy"; aqiLevel.className = "sub-text mt-2 mb-0 text-danger"; }
    else if (aqi >= 50) { aqiLevel.textContent = "Moderate"; aqiLevel.className = "sub-text mt-2 mb-0 text-warning"; }
    else { aqiLevel.textContent = "Good"; aqiLevel.className = "sub-text mt-2 mb-0 text-success"; }
    
    // Show Card
    weatherCard.classList.remove("d-none");
    weatherCard.classList.add("animate-in");
}

// ============================================
// UI UPDATE: HOURLY FORECAST (Next 72 Hours)
// ============================================
function updateHourlyUI(data) {
    hourlyForecastRow.innerHTML = "";
    
    // Next 8 intervals (24 hours, 3-hour intervals)
    const hourlyForecasts = data.list.slice(0, 8); 
    const tempUnit = currentUnit === 'metric' ? '°C' : '°F';

    hourlyForecasts.forEach(hour => {
        const date = new Date(hour.dt * 1000);
        const time = formatTime(hour.dt, data.city.timezone); 
        const iconCode = hour.weather[0].icon;
        const temp = Math.round(hour.main.temp);

        const cardHtml = `
            <div class="hourly-card-item"> 
                <p class="mb-1">${time.split(' ')[0]}</p>
                <img src="https://openweathermap.org/img/wn/${iconCode}@2x.png" alt="${hour.weather[0].description}" style="width: 45px;">
                <p class="mb-0 fw-bold">${temp}${tempUnit}</p>
            </div>
        `;
        hourlyForecastRow.innerHTML += cardHtml;
    });
}

// ============================================
// UI UPDATE: 7-DAY FORECAST LIST
// ============================================
function updateForecastUI(data) {
    dailyForecastList.innerHTML = "";
    
    // Group 3-hour forecasts into daily min/max
    const dailyData = {};
    const tempUnit = currentUnit === 'metric' ? '°C' : '°F';
    
    data.list.forEach(item => {
        const date = new Date(item.dt * 1000);
        // Use local date for grouping
        const dayKey = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        
        if (!dailyData[dayKey]) {
            dailyData[dayKey] = {
                day: date.toLocaleDateString('en-US', { weekday: 'long' }),
                minTemp: Infinity,
                maxTemp: -Infinity,
                icon: item.weather[0].icon,
                desc: item.weather[0].description,
            };
        }
        
        dailyData[dayKey].minTemp = Math.min(dailyData[dayKey].minTemp, item.main.temp_min);
        dailyData[dayKey].maxTemp = Math.max(dailyData[dayKey].maxTemp, item.main.temp_max);
        
        // Use the icon closest to 12 PM for the day icon
        if (date.getUTCHours() === 12) {
             dailyData[dayKey].icon = item.weather[0].icon;
             dailyData[dayKey].desc = item.weather[0].description;
        }
    });

    // Render the final daily list (max 7 days)
    let dayCount = 0;
    for (const key in dailyData) {
        if (dayCount >= 7) break;
        
        const day = dailyData[key];
        
        const displayDay = dayCount === 0 ? "Today" : day.day;
        
        const listItemHtml = `
            <div class="daily-forecast-item d-flex align-items-center justify-content-between">
                <div style="width: 25%; font-weight: 500;">${displayDay}</div>
                
                <div class="d-flex align-items-center" style="width: 45%;">
                    <img src="https://openweathermap.org/img/wn/${day.icon}@2x.png" alt="${day.desc}" style="width: 40px; margin-right: 10px;">
                    <span style="font-size: 0.9rem; opacity: 0.8;">${day.desc}</span>
                </div>

                <div style="width: 30%; text-align: right; font-weight: 600;">
                    <span style="opacity: 0.7;">${Math.round(day.minTemp)}${tempUnit}</span> / 
                    <span>${Math.round(day.maxTemp)}${tempUnit}</span>
                </div>
            </div>
        `;
        dailyForecastList.innerHTML += listItemHtml;
        dayCount++;
    }
}


// ============================================
// AUTOCOMPLETE FUNCTIONS
// ============================================
function handleSearchInput() {
    clearTimeout(autocompleteRequestTimeout);
    const query = searchInput.value;
    if (query.length < 3) {
        clearAutocomplete();
        return;
    }
    autocompleteRequestTimeout = setTimeout(() => {
        fetch(`/api/autocomplete?text=${query}`)
            .then(response => response.json())
            .then(data => {
                displayAutocomplete(data.features);
            })
            .catch(err => console.error("Autocomplete error:", err));
    }, 300);
}

function displayAutocomplete(features) {
    clearAutocomplete();
    if (!features || features.length === 0) return;
    features.forEach(feature => {
        const name = feature.properties.formatted;
        const item = document.createElement("a");
        item.className = "list-group-item list-group-item-action";
        item.textContent = name;
        item.onclick = (e) => {
            e.preventDefault();
            searchInput.value = feature.properties.city || feature.properties.name;
            fetchWeather(searchInput.value);
            clearAutocomplete();
        };
        autocompleteContainer.appendChild(item);
    });
}

function clearAutocomplete() {
    autocompleteContainer.innerHTML = "";
}


// ============================================
// FAVOURITE CITIES (LocalStorage)
// ============================================
function toggleFavourite() {
    if (!currentDisplayedCity) return;
    
    const cityIndex = favouriteCities.indexOf(currentDisplayedCity);
    
    if (cityIndex > -1) {
        favouriteCities.splice(cityIndex, 1);
        saveButtonContent = '<i class="bi bi-star"></i> Save';
        saveButtonClass = '';
    } else {
        favouriteCities.push(currentDisplayedCity);
        saveButtonContent = '<i class="bi bi-star-fill"></i> Saved';
        saveButtonClass = 'active';
    }
    
    saveCityButton.innerHTML = saveButtonContent;
    if (saveButtonClass) {
        saveCityButton.classList.add(saveButtonClass);
    } else {
        saveCityButton.classList.remove('active');
    }
    
    saveFavourites();
    displayFavourites();
}


function updateSaveButtonState(city) {
    if (favouriteCities.includes(city)) {
        saveCityButton.classList.add("active");
        saveCityButton.innerHTML = '<i class="bi bi-star-fill"></i> Saved';
    } else {
        saveCityButton.classList.remove("active");
        saveCityButton.innerHTML = '<i class="bi bi-star"></i> Save';
    }
}

function loadFavourites() {
    const cities = localStorage.getItem('favouriteWeatherCities');
    if (cities) {
        favouriteCities = JSON.parse(cities);
    }
    displayFavourites();
}

function saveFavourites() {
    localStorage.setItem('favouriteWeatherCities', JSON.stringify(favouriteCities));
}

function displayFavourites() {
    favouritesContainer.innerHTML = "";
    
    if (favouriteCities.length === 0) {
        favouritesContainer.innerHTML = '<span class="text-white-50">No saved cities yet.</span>';
        return;
    }
    
    favouriteCities.forEach(city => {
        const btn = document.createElement('button');
        btn.className = 'btn btn-sm fav-city-btn';
        btn.textContent = city;
        btn.onclick = () => {
            searchInput.value = city;
            fetchWeather(city);
        };
        favouritesContainer.appendChild(btn);
    });
}

// ============================================
// HELPER FUNCTIONS (UI State Management)
// ============================================
function showLoading() {
    // Show loading status
    errorMessage.textContent = "Loading weather data...";
    errorMessage.classList.remove("d-none");
    
    // Hide weather components
    weatherCard.classList.add("d-none");
    document.getElementById("detail-cards-grid").classList.add("d-none");
    dailyForecastList.classList.add("d-none");
}

function hideLoading() {
    // Hide loading status
    errorMessage.classList.add("d-none");
    // Show weather components
    document.getElementById("detail-cards-grid").classList.remove("d-none");
    dailyForecastList.classList.remove("d-none");
}

function showError(message) {
    // Hide everything and show error message
    weatherCard.classList.add("d-none");
    document.getElementById("detail-cards-grid").classList.add("d-none");
    dailyForecastList.classList.add("d-none");
    
    errorMessage.textContent = message;
    errorMessage.classList.remove("d-none");
}

function formatTime(timestamp, timezone) {
    // Convert Unix timestamp to readable time format (12-hour)
    const date = new Date((timestamp + timezone) * 1000);
    let hours = date.getUTCHours();
    const minutes = date.getUTCMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // Convert 0 to 12
    const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
    return `${hours}:${formattedMinutes} ${ampm}`;
}
    </script>
</body>
</html>